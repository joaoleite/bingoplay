<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle do Bingo</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="admin-page">
    <div class="admin-container">
        <h1>ğŸ® Controle do Bingo</h1>
        
        <div class="control-panel">
            <div class="input-section">
                <label for="numberInput">NÃºmero sorteado (1-75):</label>
                <input type="number" id="numberInput" min="1" max="75" placeholder="Digite o nÃºmero">
                <button id="drawBtn" class="btn btn-primary">Sortear NÃºmero</button>
            </div>
            
            <div class="action-buttons">
                <button id="showAllBtn" class="btn btn-secondary">Mostrar Todos os NÃºmeros</button>
                <button id="resetBtn" class="btn btn-danger">Reiniciar Jogo</button>
            </div>
        </div>
        
        <div class="network-panel">
            <h3>ğŸŒ InformaÃ§Ãµes da Rede</h3>
            <div class="network-info">
                <p><strong>IP da rede:</strong> <span id="networkIP">Carregando...</span></p>
                <p><strong>URL Admin:</strong> <span id="adminUrl">Carregando...</span></p>
                <p><strong>URL Display:</strong> <span id="displayUrl">Carregando...</span></p>
            </div>
            
            <div class="qr-codes">
                <h4>ğŸ“± QR Codes para Acesso RÃ¡pido</h4>
                <div class="qr-container">
                    <div class="qr-item">
                        <h5>ğŸ® Admin</h5>
                        <img id="qrAdmin" src="" alt="QR Admin" style="display: none;">
                        <button id="loadQrAdmin" class="btn btn-outline">Gerar QR Admin</button>
                    </div>
                    <div class="qr-item">
                        <h5>ğŸ“º Display</h5>
                        <img id="qrDisplay" src="" alt="QR Display" style="display: none;">
                        <button id="loadQrDisplay" class="btn btn-outline">Gerar QR Display</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="status-panel">
            <h3>Status do Jogo</h3>
            <div class="current-info">
                <p><strong>Ãšltimo nÃºmero:</strong> <span id="currentNumber">-</span></p>
                <p><strong>Total sorteados:</strong> <span id="totalNumbers">0</span></p>
            </div>
            
            <div class="drawn-numbers">
                <h4>NÃºmeros sorteados:</h4>
                <div id="drawnNumbersList" class="numbers-grid"></div>
            </div>
        </div>
        
        <div class="links">
            <a href="/" class="btn btn-outline">â† Voltar ao Menu</a>
            <a href="display.html" target="_blank" class="btn btn-outline">Abrir Display ğŸ“º</a>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        
        const numberInput = document.getElementById('numberInput');
        const drawBtn = document.getElementById('drawBtn');
        const showAllBtn = document.getElementById('showAllBtn');
        const resetBtn = document.getElementById('resetBtn');
        const currentNumber = document.getElementById('currentNumber');
        const totalNumbers = document.getElementById('totalNumbers');
        const drawnNumbersList = document.getElementById('drawnNumbersList');
        
        // Elementos de rede
        const networkIP = document.getElementById('networkIP');
        const adminUrl = document.getElementById('adminUrl');
        const displayUrl = document.getElementById('displayUrl');
        const qrAdmin = document.getElementById('qrAdmin');
        const qrDisplay = document.getElementById('qrDisplay');
        const loadQrAdmin = document.getElementById('loadQrAdmin');
        const loadQrDisplay = document.getElementById('loadQrDisplay');
        
        // Event listeners
        drawBtn.addEventListener('click', drawNumber);
        showAllBtn.addEventListener('click', showAllNumbers);
        resetBtn.addEventListener('click', resetGame);
        loadQrAdmin.addEventListener('click', () => loadQR('admin'));
        loadQrDisplay.addEventListener('click', () => loadQR('display'));
        
        numberInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                drawNumber();
            }
        });
        
        // Socket events
        socket.on('gameState', (state) => {
            updateUI(state);
        });
        
        socket.on('numberDrawn', (data) => {
            showSuccess(`NÃºmero ${data.number} sorteado!`);
            numberInput.value = '';
        });
        
        socket.on('showAll', (data) => {
            showSuccess('Mostrando todos os nÃºmeros!');
        });
        
        socket.on('gameReset', () => {
            showSuccess('Jogo reiniciado!');
        });
        
        // Functions
        async function drawNumber() {
            const number = parseInt(numberInput.value);
            
            if (!number || number < 1 || number > 75) {
                showError('Digite um nÃºmero vÃ¡lido entre 1 e 75');
                return;
            }
            
            try {
                const response = await fetch('/api/draw-number', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ number })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    showError(data.error);
                }
            } catch (error) {
                showError('Erro ao sortear nÃºmero');
            }
        }
        
        async function showAllNumbers() {
            try {
                await fetch('/api/show-all', { method: 'POST' });
            } catch (error) {
                showError('Erro ao mostrar nÃºmeros');
            }
        }
        
        async function resetGame() {
            if (confirm('Tem certeza que deseja reiniciar o jogo?')) {
                try {
                    await fetch('/api/reset', { method: 'POST' });
                } catch (error) {
                    showError('Erro ao reiniciar jogo');
                }
            }
        }
        
        function updateUI(state) {
            currentNumber.textContent = state.currentNumber || '-';
            totalNumbers.textContent = state.drawnNumbers.length;
            
            drawnNumbersList.innerHTML = '';
            state.drawnNumbers.sort((a, b) => a - b).forEach(num => {
                const span = document.createElement('span');
                span.className = 'drawn-number';
                span.textContent = num;
                drawnNumbersList.appendChild(span);
            });
        }
        
        function showSuccess(message) {
            showNotification(message, 'success');
        }
        
        function showError(message) {
            showNotification(message, 'error');
        }
        
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // Load network info
        async function loadNetworkInfo() {
            try {
                const response = await fetch('/api/network-info');
                const info = await response.json();
                
                networkIP.textContent = info.ip;
                adminUrl.textContent = info.adminUrl;
                displayUrl.textContent = info.displayUrl;
            } catch (error) {
                console.error('Erro ao carregar info da rede:', error);
            }
        }
        
        // Load QR Code
        async function loadQR(type) {
            try {
                const response = await fetch(`/api/qr/${type}`);
                const data = await response.json();
                
                if (type === 'admin') {
                    qrAdmin.src = data.qrCode;
                    qrAdmin.style.display = 'block';
                    loadQrAdmin.style.display = 'none';
                } else {
                    qrDisplay.src = data.qrCode;
                    qrDisplay.style.display = 'block';
                    loadQrDisplay.style.display = 'none';
                }
            } catch (error) {
                showError('Erro ao gerar QR Code');
            }
        }
        
        // Load initial state
        fetch('/api/status')
            .then(response => response.json())
            .then(state => updateUI(state));
            
        // Load network info
        loadNetworkInfo();
    </script>
</body>
</html>